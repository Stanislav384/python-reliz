--!strict

local tool = script.Parent
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Debris = game:GetService("Debris")

-- Объект-образец для создания, находится в ReplicatedStorage. 
-- Вы можете добавить туда свои модели, части и т.д.
local brickTemplate = ReplicatedStorage:FindFirstChild("MyAwesomePart") 
if not brickTemplate then
	warn("Объект 'MyAwesomePart' не найден в ReplicatedStorage! Будет создан обычный Part.")
end

local MIN_CAST_DISTANCE = 5
local MAX_CAST_DISTANCE = 50

-- Создаем локальный эффект спавна
local function createSpawnEffect(position: Vector3)
	local effectPart = Instance.new("Part")
	effectPart.Position = position
	effectPart.Size = Vector3.new(2, 2, 2)
	effectPart.Transparency = 1
	effectPart.CanCollide = false
	effectPart.Anchored = true
	effectPart.Parent = workspace

	local light = Instance.new("PointLight")
	light.Color = BrickColor.Random().Color
	light.Range = 25
	light.Brightness = 5
	light.Parent = effectPart

	local spark = Instance.new("SparklesEffect")
	spark.Enabled = true
	spark.SparkleColor = light.Color
	spark.Parent = effectPart

	Debris:AddItem(effectPart, 1) -- Эффект исчезнет через 1 секунду
end

-- Главная функция
local function onActivated()
	local player = Players.LocalPlayer
	local character = player.Character
	local mouse = player:GetMouse()

	if not character or not mouse.Target then return end

	-- Проверяем расстояние, чтобы не спавнить слишком далеко
	local distance = (mouse.Hit.Position - character.HumanoidRootPart.Position).Magnitude
	if distance < MIN_CAST_DISTANCE or distance > MAX_CAST_DISTANCE then
		print("Невозможно создать объект. Кликните на что-то в пределах " .. MAX_CAST_DISTANCE .. " студ.")
		return
	end

	local newObject: Part | Model

	-- Клонируем объект из ReplicatedStorage, если он существует
	if brickTemplate then
		newObject = brickTemplate:Clone()
	else
		-- Если нет, создаем обычную часть
		newObject = Instance.new("Part")
		newObject.Size = Vector3.new(4, 4, 4)
	end

	newObject.CFrame = mouse.Hit -- Размещаем объект прямо в точке клика
	newObject.Anchored = false
	newObject.BrickColor = BrickColor.Random()
	newObject.Parent = workspace

	createSpawnEffect(newObject.Position)

	-- Добавляем возможность временного существования или другие свойства
	-- например, для Part можно создать скрипт, чтобы он взрывался
	if newObject:IsA("Part") then
		local destroyScript = Instance.new("Script")
		destroyScript.Parent = newObject
		destroyScript.Source = [[
            wait(5) -- Взорвется через 5 секунд
            local explosion = Instance.new("Explosion")
            explosion.Parent = script.Parent.Parent
            explosion.Position = script.Parent.Position
            script.Parent:Destroy()
        ]]
	end
end

tool.Activated:Connect(onActivated)
